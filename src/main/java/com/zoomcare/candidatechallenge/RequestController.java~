package com.zoomcare.candidatechallenge;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import java.util.List;
import java.util.ArrayList;
import java.math.BigInteger;

@Controller
public class RequestController {

    @GetMapping("/")
    public String index() {
	return "index";
    }

    @GetMapping("/allEmployees")
    public String fullEmployeeList(Model model){
	List<Employee> employees = findAllEmployees();
	model.addAttribute("employeeCount", 0);
	return "allEmployeeList";
    }

    
    @Autowired
    JdbcTemplate jdbcTemplate;

    public List<Employee> findAllEmployees(){
	List<Employee> rtv = new ArrayList();
	jdbcTemplate.query(
			   "SELECT id, supervisorId FROM Employee",
			   (rs, rowNum) -> {
			   		System.out.println(rs.getString("id"));
			       return new Employee(new BigInteger(rs.getString("id")), new BigInteger(rs.getString("supervisorId")));}
			   )
	    .forEach(e -> rtv.add(e))
	    ;
	return rtv;
    }
}
